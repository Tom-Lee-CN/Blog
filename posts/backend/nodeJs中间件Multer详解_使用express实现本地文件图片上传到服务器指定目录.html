<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>nodeJs中间件Multer详解_使用express实现本地文件/图片上传到服务器指定目录 | Tom`s Blog</title><meta name="description" content="欢迎来到Tom`s Blog">
    <link rel="preload" href="/Blog/assets/style-BhOYgqmK.css" as="style"><link rel="stylesheet" href="/Blog/assets/style-BhOYgqmK.css">
    <link rel="modulepreload" href="/Blog/assets/app-DCzuWk7c.js"><link rel="modulepreload" href="/Blog/assets/nodeJs中间件Multer详解_使用express实现本地文件图片上传到服务器指定目录.html-BMAdKuVA.js">
    <link rel="prefetch" href="/Blog/assets/index.html-B7k01x-C.js" as="script"><link rel="prefetch" href="/Blog/assets/get-started.html-CoYxEMce.js" as="script"><link rel="prefetch" href="/Blog/assets/CORS跨域.html-CTTaRlK4.js" as="script"><link rel="prefetch" href="/Blog/assets/Express框架基础.html-BjZI7hiS.js" as="script"><link rel="prefetch" href="/Blog/assets/NODE与邮箱邮件发送.html-CKvUCzxc.js" as="script"><link rel="prefetch" href="/Blog/assets/NODE中使用UUID.html-C570vvHg.js" as="script"><link rel="prefetch" href="/Blog/assets/NODE原生HTTP.html-DuJevNd4.js" as="script"><link rel="prefetch" href="/Blog/assets/SEESION与JWT.html-Cp_LMYA9.js" as="script"><link rel="prefetch" href="/Blog/assets/node与mysql.html-C_hp_f76.js" as="script"><link rel="prefetch" href="/Blog/assets/Cookie与Storage.html-BNpChu3u.js" as="script"><link rel="prefetch" href="/Blog/assets/Cookie的详细资料.html-BCdinKt4.js" as="script"><link rel="prefetch" href="/Blog/assets/Cookie的跨域传输.html-BnM3DKHw.js" as="script"><link rel="prefetch" href="/Blog/assets/Git的基本使用.html-BB7zqetM.js" as="script"><link rel="prefetch" href="/Blog/assets/JSON Web Token 入门教程.html-ChRaTT46.js" as="script"><link rel="prefetch" href="/Blog/assets/archive2.html-D3VkMMEI.js" as="script"><link rel="prefetch" href="/Blog/assets/sticky.html-KwhlfAgA.js" as="script"><link rel="prefetch" href="/Blog/assets/sticky2.html-D97ml3vl.js" as="script"><link rel="prefetch" href="/Blog/assets/CSS基础.html-C6xPccx4.js" as="script"><link rel="prefetch" href="/Blog/assets/Cookie与Storage.html-CiPrraFs.js" as="script"><link rel="prefetch" href="/Blog/assets/JS基础_JS执行环境_作用域(上下文).html-DV4qXHXU.js" as="script"><link rel="prefetch" href="/Blog/assets/JavaScript 运行机制详解：再谈 Event Loop.html-DkZlOQHD.js" as="script"><link rel="prefetch" href="/Blog/assets/Promise.html-VZrI4Fwz.js" as="script"><link rel="prefetch" href="/Blog/assets/localStorage、sessionStorage 与 Cookie_localstorage和sessionstorage和cookie-CSDN博客.html-DGh-an_E.js" as="script"><link rel="prefetch" href="/Blog/assets/pinia使用方法.html-BeVa1jiA.js" as="script"><link rel="prefetch" href="/Blog/assets/vue使用iFrame嵌入网页，网页等比缩放，全部展示.html--78FBJP2.js" as="script"><link rel="prefetch" href="/Blog/assets/为什么javascript开发人员应优先选择axios而不是fetch.html-ng4DcEnQ.js" as="script"><link rel="prefetch" href="/Blog/assets/前端必备技能：全面解析 Session 在 Web 开发中的应用.html-Ct0Jg0tR.js" as="script"><link rel="prefetch" href="/Blog/assets/原型与面向对象.html-kpY0MxNp.js" as="script"><link rel="prefetch" href="/Blog/assets/原生与Fetch的HTTP请求.html-871wP5S_.js" as="script"><link rel="prefetch" href="/Blog/assets/回调函数.html-Dpi7liwH.js" as="script"><link rel="prefetch" href="/Blog/assets/闭包与this指向和函数上下文调用.html-BmAHCHw_.js" as="script"><link rel="prefetch" href="/Blog/assets/404.html-DN2LvMvJ.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-Br0BV5Bh.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-B9k8afNY.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-iER2jIEU.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-Dp7I7S5j.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-DCeCWl9c.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-Gv6-Rnyf.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-O-6FDtP1.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-BWxfQTg4.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-2Zpu2e3F.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-2ti9-wGL.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-D9TaX6i0.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-MeuTJBSM.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-AmmiYiRF.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-CZrUYbgO.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-DJEZ83uT.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-D9WxIJQQ.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-Bo4dQKgJ.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-CUU6ft67.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-C6N32PFM.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-Bo4dQKgJ.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-az3hBZLk.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-CqCHUxV-.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-By6ENlB0.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-COpTSeFD.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-FrasgwFd.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-a3DEdIhz.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-Duruevod.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-zqKBFxIu.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-CNlKpVxN.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-CC4XyLxB.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/Blog/"><img class="vp-site-logo" src="https://vuejs.press/images/hero.png" alt="Tom`s Blog"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Tom`s Blog</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/article/" aria-label="文章"><!--[--><!--[--><!--]--><!--]-->文章<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/category/" aria-label="分类"><!--[--><!--[--><!--]--><!--]-->分类<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/tag/" aria-label="标签"><!--[--><!--[--><!--]--><!--]-->标签<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/timeline/" aria-label="最新"><!--[--><!--[--><!--]--><!--]-->最新<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/article/" aria-label="文章"><!--[--><!--[--><!--]--><!--]-->文章<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/category/" aria-label="分类"><!--[--><!--[--><!--]--><!--]-->分类<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/tag/" aria-label="标签"><!--[--><!--[--><!--]--><!--]-->标签<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/Blog/timeline/" aria-label="最新"><!--[--><!--[--><!--]--><!--]-->最新<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">nodeJs中间件Multer详解_使用express实现本地文件/图片上传到服务器指定目录 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="nodejs中间件multer详解-使用express实现本地文件-图片上传到服务器指定目录" tabindex="-1"><a class="header-anchor" href="#nodejs中间件multer详解-使用express实现本地文件-图片上传到服务器指定目录"><span>nodeJs中间件Multer详解_使用express实现本地文件/图片上传到服务器指定目录</span></a></h1><p>最终实现的效果，更改Input的值后，将图片显示出来、输入描述信息，提交后，图片上传到后台对应的路径下。 <img src="https://i-blog.csdnimg.cn/blog_migrate/3bef0e0df4fc8d6329bdbacd185c0087.png" alt="Multer 实现本地文件/图片上传"></p><h2 id="multer" tabindex="-1"><a class="header-anchor" href="#multer"><span>Multer</span></a></h2><ul><li>Multer 是一个node.js中间件，用于处理 <code>multipart/form-data</code>类型的表单数据，主要用于上传文件。</li><li>在form表单上要加上 enctype=“multipart/form-data” 的属性。</li><li>Multer 不会处理任何非 multipart/form-data 类型的表单数据。</li><li>不要将 Multer 作为全局中间件使用，因为恶意用户可以上传文件到一个你没有预料到的路由，应该只在你需要处理上传文件的路由上使用。</li></ul><h2 id="_1-安装" tabindex="-1"><a class="header-anchor" href="#_1-安装"><span>1. 安装</span></a></h2><p>终端中输入以下命令 <code>npm install --save multer</code> 或者使用yarn命令 <code>yarn add multer -S</code></p><h2 id="_2-简单使用" tabindex="-1"><a class="header-anchor" href="#_2-简单使用"><span>2. 简单使用</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> multer<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">,</span>uploadFile<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//这里的req.body是经过uploadFile中间件进行处理后的,包含了表单中所有的提交内容</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;文件上传成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//自定义中间件</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">//dest 值为文件存储的路径;single方法,表示上传单个文件,参数为表单数据对应的key</span></span>
<span class="line">	<span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">dest</span><span class="token operator">:</span><span class="token string">&quot;attachment/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token function">upload</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">//打印结果看下面的截图</span></span>
<span class="line">	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">	        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;err:&quot;</span><span class="token operator">+</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">	        <span class="token comment">//将文件信息赋值到req.body中，继续执行下一步</span></span>
<span class="line">	        req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>photo<span class="token operator">=</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>filename<span class="token punctuation">;</span></span>
<span class="line">	        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	    <span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">123456789101112131415161718192021222324252627</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>表单提交文件，访问 localhost:3000/upload 接口后，就可以在attachment 目录里看到刚刚上传的文件，为了避免命名冲突，Multer 默认会修改上传的文件名为随机字符。如果想自定义文件名称， 可以在 DiskStorage 中配置。 <img src="https://i-blog.csdnimg.cn/blog_migrate/f16dc7627d59876bb6e56de1fc049ff6.png" alt="Multer 实现本地文件/图片上传"> req.file 打印结果如下图： <img src="https://i-blog.csdnimg.cn/blog_migrate/30bbfc8b9b0abe61ac4fe489f52e3533.png" alt="Multer 实现本地文件/图片上传"> 每个文件（req.file）具有下面的信息:</p><table><thead><tr><th>属性</th><th>描述</th><th>说明</th></tr></thead><tbody><tr><td>fieldname</td><td>Field name 由表单指定</td><td></td></tr><tr><td>originalname</td><td>用户计算机上的文件的名称</td><td></td></tr><tr><td>encoding</td><td>文件编码</td><td></td></tr><tr><td>mimetype</td><td>文件的 MIME 类型</td><td></td></tr><tr><td>size</td><td>文件大小（字节单位）</td><td></td></tr><tr><td>destination</td><td>保存路径</td><td>可以在 DiskStorage 中设置</td></tr><tr><td>filename</td><td>保存在 destination 中的文件名</td><td>可以在 DiskStorage 中设置</td></tr><tr><td>path</td><td>已上传文件的完整路径</td><td>可以在 DiskStorage 中设置</td></tr><tr><td>buffer</td><td>一个存放了整个文件的 Buffer</td><td>可以在 MemoryStorag 中设置</td></tr></tbody></table><h2 id="_3-方法" tabindex="-1"><a class="header-anchor" href="#_3-方法"><span>3. 方法</span></a></h2><h3 id="_3-1-multer-options-single-fieldname" tabindex="-1"><a class="header-anchor" href="#_3-1-multer-options-single-fieldname"><span>3.1 multer(options).single(fieldname)</span></a></h3><p>上传单个文件内容，如一次只上传一张图片。fieldname为上传时文件的字段名称。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">//上传单个图片</span></span>
<span class="line"><span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">dest</span><span class="token operator">:</span><span class="token string">&quot;attachment/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">12</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上传的数据格式如下： <img src="https://i-blog.csdnimg.cn/blog_migrate/e9c2e116671489b31ab13be74905bc82.png" alt="Multer 实现本地文件/图片上传"></p><h3 id="_3-2-multer-options-array-fieldname-maxcount" tabindex="-1"><a class="header-anchor" href="#_3-2-multer-options-array-fieldname-maxcount"><span>3.2 multer(options).array(fieldname[,maxCount])</span></a></h3><p>适用于同一个字段，一次上传多个文件的情况，例如发状态时，选择多张图片发送。接受一个以 fieldname 命名的文件数组。可以指定 maxCount 来限制上传的最大数量。这些文件的信息保存在 req.files。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">//一次最多上传3个文件</span></span>
<span class="line"><span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">dest</span><span class="token operator">:</span><span class="token string">&quot;attachment/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">12</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上传的数据格式如下： <img src="https://i-blog.csdnimg.cn/blog_migrate/05e2e5222ba3f357b1e92568653ba62a.png" alt="Multer 实现本地文件/图片上传"></p><h3 id="_3-3-multer-options-fields-fields" tabindex="-1"><a class="header-anchor" href="#_3-3-multer-options-fields-fields"><span>3.3 multer(options).fields(fields)</span></a></h3><p>适用于上传多个字段的情况。接受指定 fields 的混合文件。这些文件的信息保存在 req.files。fields 是一个对象数组，具有 name 和可选的 maxCount 属性。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> fieldsList<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;photo1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;photo2&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">maxCount</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">dest</span><span class="token operator">:</span><span class="token string">&quot;attachment/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span>fieldsList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">12345</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上传的数据格式如下： <img src="https://i-blog.csdnimg.cn/blog_migrate/6b1552dba8ff059b0f1b4ef4297c2d7a.png" alt="Multer 实现本地文件/图片上传"></p><h3 id="_3-4-multer-options-none" tabindex="-1"><a class="header-anchor" href="#_3-4-multer-options-none"><span>3.4 multer(options).none()</span></a></h3><p>接收只有文本域的表单，如果上传任何文件，会返回 “LIMIT_UNEXPECTED_FILE” 错误。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">dest</span><span class="token operator">:</span><span class="token string">&quot;attachment/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">none</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-multer-options-any" tabindex="-1"><a class="header-anchor" href="#_3-5-multer-options-any"><span>3.5 multer(options).any()</span></a></h3><p>接收一切上传的文件。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">dest</span><span class="token operator">:</span><span class="token string">&quot;attachment/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-multer-options-配置项" tabindex="-1"><a class="header-anchor" href="#_4-multer-options-配置项"><span>4. multer(options) 配置项</span></a></h2><p>Multer 接受一个 options 对象，其中最基本的是 dest 属性，这将告诉 Multer 将上传文件保存在哪。如果省略 options 对象，这些文件将保存在内存中，永远不会写入磁盘，options 配置如下：</p><table><thead><tr><th>属性值</th><th>描述</th></tr></thead><tbody><tr><td>dest or storage</td><td>在哪里存储文件</td></tr><tr><td>limits</td><td>限制上传数据的大小</td></tr><tr><td>fileFilter</td><td>文件过滤器，控制哪些文件可以被接受</td></tr><tr><td>preservePath</td><td>保存包含文件名的完整文件路径</td></tr></tbody></table><h3 id="_4-1-dest" tabindex="-1"><a class="header-anchor" href="#_4-1-dest"><span>4.1 dest</span></a></h3><p>指定上传文件的存储路径。文件名默认为随机字符。如果想自定义文件名称， 使用下面 DiskStorage 来配置。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">var</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">dest</span><span class="token operator">:</span><span class="token string">&quot;attachment/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-storaged-存储引擎" tabindex="-1"><a class="header-anchor" href="#_4-2-storaged-存储引擎"><span>4.2 storaged 存储引擎</span></a></h3><p><strong>DiskStorage 磁盘存储引擎</strong></p><p>磁盘存储引擎可以让你控制文件的存储。有两个属性，属性值都是函数。destination，指定文件存储的路径；filename，指定文件的存储名称。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> multer<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//获取绝对路径</span></span>
<span class="line"><span class="token keyword">let</span> fullPath<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">&quot;/attachment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//设置文件的名称</span></span>
<span class="line"><span class="token keyword">let</span> filename<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> storage<span class="token operator">=</span>multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">	<span class="token comment">//设置存储路径</span></span>
<span class="line">    <span class="token function-variable function">destination</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>file<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;destination:&quot;</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打印结果如下图</span></span>
<span class="line">        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">//设置存储的文件名</span></span>
<span class="line">    <span class="token function-variable function">filename</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>file<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;filename:&quot;</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打印结果如下图</span></span>
<span class="line">        <span class="token comment">//获取文件的扩展名</span></span>
<span class="line">        <span class="token keyword">let</span> extname<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        filename<span class="token operator">=</span>file<span class="token punctuation">.</span>fieldname<span class="token operator">+</span><span class="token string">&quot;-&quot;</span><span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>extname<span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>storage<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">1234567891011121314151617181920212223</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数 file 中包含以下内容： <img src="https://i-blog.csdnimg.cn/blog_migrate/5327618ba48c4943362a588a6c2782a4.png" alt="Multer 实现本地文件/图片上传"><strong>MemoryStorage 内存存储引擎</strong></p><ul><li>内存存储引擎将文件存储在内存中的 Buffer 对象，它没有任何选项。</li><li>当使用内存存储引擎，文件信息将包含一个 buffer 字段，里面包含了整个文件数据。</li><li>当使用内存存储，上传非常大的文件，或者非常多的小文件，会导致你的应用程序内存溢出。</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">var</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">memoryStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>storage<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">12</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-limits" tabindex="-1"><a class="header-anchor" href="#_4-3-limits"><span>4.3 limits</span></a></h3><p>用来指定一些数据大小的限制，设置 limits 可以帮助保护你的站点抵御拒绝服务 (DoS) 攻击。</p><table><thead><tr><th>属性</th><th>值类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>files</td><td>Number</td><td>无限</td><td>在 multipart 表单中，上传文件的最大数量</td></tr><tr><td>fileSize</td><td>Number</td><td>无限</td><td>上传时，每一个文件最大长度 (单位：bytes)</td></tr><tr><td>fields</td><td>Number</td><td>无限</td><td>非文件 field 的最大数量（提交表单时，可以提交非文件的字段的数量）</td></tr><tr><td>fieldNameSize</td><td>Number</td><td>100 bytes</td><td>上传时，每一个 field 名字的最大长度</td></tr><tr><td>fieldSize</td><td>Number</td><td>1048576 bytes，即1MB</td><td>上传时，每一个 field 的最大长度</td></tr><tr><td>parts</td><td>Number</td><td>无限</td><td>在 multipart 表单中，part 传输的最大数量(fields + files)</td></tr><tr><td>headerPairs</td><td>Number</td><td>2000</td><td>在 multipart 表单中，键值对最大组数</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> multer<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">limits</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">        	<span class="token literal-property property">files</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//最多上传2个文件</span></span>
<span class="line">            <span class="token literal-property property">fileSize</span><span class="token operator">:</span><span class="token number">5120</span> <span class="token comment">//设置单个文件最大为 5kb</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">1234567</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-filefilter" tabindex="-1"><a class="header-anchor" href="#_4-4-filefilter"><span>4.4 fileFilter</span></a></h3><p>fileFilter 为一个函数，用来控制什么文件可以上传以及什么文件应该跳过。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">fileFilter</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 通过调用cb,用boolean值来指示是否应接受该文件</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 拒绝这个文件，使用`false`，像这样:</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 接受这个文件，使用`true`，像这样:</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 如果有问题，你可以总是这样发送一个错误:</span></span>
<span class="line">  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;I don\&#39;t have a clue!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token constant">AI</span>写代码javascript运行<span class="token number">1234567891011121314</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-错误处理机制" tabindex="-1"><a class="header-anchor" href="#_5-错误处理机制"><span>5. 错误处理机制</span></a></h2><p>当遇到一个错误，multer 将会把错误发送给 express。如果你想捕捉 Multer 错误，你可以使用 multer 对象下的 MulterError 类 (即 err instanceof multer.MulterError)。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">var</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token function">upload</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">multer<span class="token punctuation">.</span>MulterError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	  <span class="token comment">// 捕捉 Multer 错误</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	  <span class="token comment">// 捕捉 express 错误</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">	  <span class="token comment">// 上传成功</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-完整案例" tabindex="-1"><a class="header-anchor" href="#_6-完整案例"><span>6. 完整案例</span></a></h2><p>项目结构如下： <img src="https://i-blog.csdnimg.cn/blog_migrate/207e38f69c391a7e68899d40c11b8e36.png" alt="Multer 实现本地文件/图片上传"> 代码如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">//index.js</span></span>
<span class="line"><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> uploadFile<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./uploadfile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//使用uploadFile中间件</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">,</span>uploadFile<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//将req.body里的数据存储到数据库</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;文件上传成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//uploadFile.js</span></span>
<span class="line"><span class="token keyword">const</span> multer<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> fullPath<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">&quot;/attachment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> filename<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">let</span> storage<span class="token operator">=</span>multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    	<span class="token comment">//设置文件存储路径</span></span>
<span class="line">        <span class="token function-variable function">destination</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>file<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment">//设置文件存储名称</span></span>
<span class="line">        <span class="token function-variable function">filename</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>file<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">let</span> extname<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            filename<span class="token operator">=</span>file<span class="token punctuation">.</span>fieldname<span class="token operator">+</span><span class="token string">&quot;-&quot;</span><span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>extname<span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token comment">//上传单张图片</span></span>
<span class="line">    <span class="token keyword">let</span> upload<span class="token operator">=</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>storage<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">upload</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">multer<span class="token punctuation">.</span>MulterError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;multererr:&quot;</span><span class="token operator">+</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;err:&quot;</span><span class="token operator">+</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        	<span class="token comment">//上传成功后，将图片写在req.body.photo中，继续住下执行</span></span>
<span class="line">            req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>photo<span class="token operator">=</span>filename<span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-前端代码" tabindex="-1"><a class="header-anchor" href="#_7-前端代码"><span>7. 前端代码</span></a></h2><p>简单写个例子，在前端试一下</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:3000/upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>80<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>photo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输描述信息<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>	</span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">	<span class="token keyword">let</span> $img<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token keyword">let</span> $input<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">	$input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span>changeHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token keyword">function</span> <span class="token function">changeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">//显示选中的图片</span></span>
<span class="line">		<span class="token keyword">let</span> f<span class="token operator">=</span>$input<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">let</span> src<span class="token operator">=</span>window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		$img<span class="token punctuation">.</span>src<span class="token operator">=</span>src<span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated:: </span><time class="meta-item-info" datetime="2025-07-11T15:11:46.000Z" data-allow-mismatch>7/11/25, 3:11 PM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: tomweichat@qq.com">Tom-Lee-CN</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/Blog/assets/app-DCzuWk7c.js" defer></script>
  </body>
</html>
